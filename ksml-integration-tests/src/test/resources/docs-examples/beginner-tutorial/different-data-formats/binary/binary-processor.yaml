streams:
  binary_input:
    topic: ksml_sensordata_binary
    keyType: string
    valueType: bytes
    offsetResetPolicy: latest

  binary_output:
    topic: ksml_sensordata_binary_processed
    keyType: string
    valueType: bytes

functions:
  increment_first_byte:
    type: valueTransformer
    code: |
      # Simple binary manipulation: increment the first data byte
      if isinstance(value, list) and len(value) > 0:
        modified = list(value)
        modified[0] = (modified[0] + 1) % 256  # Increment and wrap at 256
        result = modified
      else:
        result = value
    expression: result
    resultType: bytes

pipelines:
  process_binary:
    from: binary_input
    via:
      # Log input binary
      - type: peek
        forEach:
          code: |
            log.info("Binary input: key={}, bytes={}", key, value)

      # Modify binary data
      - type: transformValue
        mapper: increment_first_byte

      # Log output binary
      - type: peek
        forEach:
          code: |
            log.info("Binary output: key={}, bytes={}", key, value)

    to: binary_output
