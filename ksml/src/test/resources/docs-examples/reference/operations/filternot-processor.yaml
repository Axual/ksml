streams:
  product_input:
    topic: product_stream
    keyType: string
    valueType: json

functions:
  is_inactive_product:
    type: predicate
    code: |
      if value is None:
        return False
      
      status = value.get("status", "")
      if status == "inactive":
        print(f"Filtering out inactive product: {value.get('product_id')} - {value.get('name')}")
        return True
      
      return False

pipelines:
  main:
    from: product_input
    via:
      - type: filterNot
        if: is_inactive_product
      - type: peek
        forEach:
          code: |
            print(f"Active product kept: {key} - {value['name']} (status: {value['status']}, price: ${value['price']})")
    to:
      topic: active_products
      keyType: string
      valueType: json