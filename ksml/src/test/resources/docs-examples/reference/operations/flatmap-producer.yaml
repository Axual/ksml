functions:
  generate_order_batch:
    type: generator
    globalCode: |
      import json, random
      counter = 0
    code: |
      global counter
      counter += 1
      cust = random.choice(["alice", "bob", "charlie"])
      batch = {
        "order_id": f"ord-{counter}",
        "customer_id": cust,
        "items": [
          {"item_id": "laptop", "quantity": 1, "price": 999.99},
          {"item_id": "mouse", "quantity": 2, "price": 29.99},
          {"item_id": "keyboard", "quantity": 1, "price": 79.99}
        ]
      }
      return cust, json.dumps(batch)
    resultType: (string, json)

producers:
  order_batch_producer:
    generator: generate_order_batch
    interval: 3s
    to:
      topic: order_batches
      keyType: string
      valueType: json