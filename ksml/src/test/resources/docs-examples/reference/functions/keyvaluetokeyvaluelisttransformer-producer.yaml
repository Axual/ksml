functions:
  generate_batch_orders:
    type: generator
    globalCode: |
      import random
      counter = 0
    code: |
      global counter
      counter += 1
      bid = f"b{counter:03d}"
      prods = ["laptop", "phone", "tablet"]
      custs = ["alice@co", "bob@co", "charlie@co"]
      orders = [{"product": random.choice(prods), "qty": random.randint(1,5), 
                 "customer": random.choice(custs)} for _ in range(random.randint(2,4))]
      return bid, {"batch_id": bid, "orders": orders, "total": len(orders)}
    resultType: (string, json)

producers:
  batch_order_producer:
    generator: generate_batch_orders
    interval: 3s
    to:
      topic: batch_orders
      keyType: string
      valueType: json