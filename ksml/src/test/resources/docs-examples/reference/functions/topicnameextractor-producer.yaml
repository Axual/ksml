functions:
  generate_sensor_data:
    type: generator
    globalCode: |
      import random
      counter = 0
      sensor_types = ["temperature", "humidity", "pressure"]
      locations = ["factory_a", "factory_b", "warehouse"]
    code: |
      global counter, sensor_types, locations
      
      # Generate sensor ID as key
      sensor_id = f"sensor_{counter % 10:02d}"
      counter += 1
      
      # Generate sensor reading
      sensor_type = random.choice(sensor_types)
      
      value = {
        "sensor_id": sensor_id,
        "sensor_type": sensor_type,
        "location": random.choice(locations),
        "reading": round(random.uniform(10.0, 100.0), 2),
        "timestamp": counter * 1000,
        "alert_level": random.choices(["normal", "warning", "critical"], [80, 15, 5])[0]
      }
      
    expression: (sensor_id, value)
    resultType: (string, json)

producers:
  sensor_producer:
    generator: generate_sensor_data
    interval: 2s
    to:
      topic: mixed_sensor_data
      keyType: string
      valueType: json