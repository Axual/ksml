# Producer for database lookup demo - generates product events

functions:
  generate_product_events:
    type: generator
    globalCode: |
      import random
      import time
      event_counter = 0
      product_ids = ["PROD001", "PROD002", "PROD003", "PROD004", "PROD005"]
      event_types = ["viewed", "added_to_cart", "purchased", "removed_from_cart"]
    code: |
      global event_counter, product_ids, event_types
      
      event_counter += 1
      product_id = random.choice(product_ids)
      event_type = random.choice(event_types)
      quantity = random.randint(1, 5) if event_type in ["added_to_cart", "purchased"] else 1
      current_timestamp = int(time.time() * 1000)
      
      # Create structured JSON product event for better readability in Kowl UI
      product_event = {
        "event_id": f"product_event_{event_counter:06d}",
        "event_type": event_type,
        "product_id": product_id,
        "quantity": quantity,
        "timestamp": current_timestamp,
        "user_id": f"user_{random.randint(1000, 9999)}",
        "session_id": f"session_{event_counter // 10}_{random.randint(100, 999)}",
        "page_location": random.choice(["/products", "/category", "/search"]),
        "metadata": {
          "simulation": True,
          "database_lookup": True
        }
      }
      
    expression: (product_id, product_event)
    resultType: (string, json)

producers:
  product_event_producer:
    generator: generate_product_events
    interval: 2s
    to:
      topic: product_events
      keyType: string
      valueType: json