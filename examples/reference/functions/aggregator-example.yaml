functions:
  average_calculator:
    type: aggregator
    code: |
      if aggregatedValue is None:
        return {'count': 1, 'sum': value['amount'], 'average': value['amount']}
      else:
        count = aggregatedValue['count'] + 1
        sum = aggregatedValue['sum'] + value['amount']
        return {'count': count, 'sum': sum, 'average': sum / count}
    resultType: struct
