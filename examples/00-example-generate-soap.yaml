# This example shows how to generate data and have it sent to a target topic in a given format.

functions:
  generate_soap_message:
    type: generator
    globalCode: |
      sensorCounter = 1
    code: |
      global sensorCounter
      key = "sensor"+str(sensorCounter)
      sensorCounter = (sensorCounter+1) % 10
      
      value = {"envelope":{"header":{"elements":[{"qname":{"localPart":"localHeader","namespaceURI":"https://some.site","prefix":"pre-fix"},"actor":"actor","role":"role","mustUnderstand":"true","relay":"true"}]}, "body":{"elements":[{"qname":{"localPart":"localBody", "namespaceURI": "https://some.new.site", "prefix":"broken"},"value": "<GetQuotation><QuotationsName>ACME Corp</QuotationsName><GetSomethingElse><SomethingElseName1>ACME Corp something else 1</SomethingElseName1><SomethingElseName2>ACME Corp something else 2</SomethingElseName2><SomethingElseName3>ACME Corp something else 3</SomethingElseName3></GetSomethingElse></GetQuotation>"}]}}}
    expression: (key,value)
    resultType: (string,soap)

  generate_soap_message_alternative:
      type: generator
      globalCode: |
        sensorCounter = 1
      code: |
        global sensorCounter
        key = "sensor"+str(sensorCounter)
        sensorCounter = (sensorCounter+1) % 10
  
        value = """<?xml version = "1.0"?>
        <env:Envelope xmlns:env="http://www.w3.org/2003/05/soap-envelope">
        <env:Header><pre-fix:localHeader xmlns:pre-fix="https://some.site" env:role="role"/>
        </env:Header>
        <env:Body>
        <GetQuotation>
        <QuotationsName>ACME Corp</QuotationsName>
        </GetQuotation>
        <GetSomethingElse>
        <SomethingElseName1>ACME Corp something else 1</SomethingElseName1>
        <SomethingElseName2>ACME Corp something else 2</SomethingElseName2>
        <SomethingElseName3>ACME Corp something else 3</SomethingElseName3>
        </GetSomethingElse>
        </env:Body>
        </env:Envelope>"""
      expression: (key,value)
      resultType: (string,string)

producers:
  soap_producer_1:
    generator: generate_soap_message
    interval: 777
    to:
      topic: ksml_soap
      keyType: string
      valueType: soap

  soap_producer_2:
    generator: generate_soap_message_alternative
    interval: 777
    to:
      topic: ksml_soap
      keyType: string
      valueType: soap
