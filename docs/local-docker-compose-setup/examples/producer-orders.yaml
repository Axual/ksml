functions:
  generate_order:
    type: generator
    globalCode: |
      import random
      import time
      order_counter = 0
      customers = ["CUST001", "CUST002", "CUST003", "CUST004", "CUST005"]
      products = ["PROD001", "PROD002", "PROD003", "PROD004", "PROD005"]
    code: |
      global order_counter, customers, products
      
      order_counter += 1
      customer_id = random.choice(customers)
      
      # Generate order
      value = {
        "order_id": f"ORD{order_counter:04d}",
        "customer_id": customer_id,
        "product_id": random.choice(products),
        "quantity": random.randint(1, 5),
        "amount": round(random.uniform(10.0, 200.0), 2),
        "timestamp": int(time.time() * 1000)
      }
      
      # Use customer_id as key for stream-table join
      key = customer_id
    expression: (key, value)
    resultType: (string, json)

producers:
  order_producer:
    generator: generate_order
    interval: 2s
    to:
      topic: new_orders
      keyType: string
      valueType: json