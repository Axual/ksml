name: "Segment Data Producer"
version: "1.0"
description: |
  This producer is part of the Data Transformation Use Case in KSML documentation. It produces customer segment data to
  a topic in JSON format.

functions:
  customer_segment_generator:
    globalCode: |
      import random
      count = 0
    code: |
      global count
      refs = {
        0: {"key": "A", "value": {"segment_name": "Premium", "discount_tier": "Tier 1", "marketing_group": "High Value"}},
        1: {"key": "B", "value": {"segment_name": "Standard", "discount_tier": "Tier 2", "marketing_group": "Medium Value"}},
        2: {"key": "C", "value": {"segment_name": "Basic", "discount_tier": "Tier 3", "marketing_group": "Growth Target" }}
      }
      key = refs.get(count)["key"]
      value = refs.get(count)["value"]
      count = (count + 1) % 3
      return (key, value)
    resultType: (string, struct)

producers:
  customer_segment_producer:
    generator: customer_segment_generator
    interval: 10s
    count: 3
    to:
      topic: customer_segments
      keyType: string  # segment code
      valueType: json  # segment details
