functions:
  generate_user_activity:
    type: generator
    globalCode: |
      import time
      import random
      activity_id = 0
      user_ids = ["user_001", "user_002", "user_003", "user_004", "user_005"]
      activity_types = ["login", "purchase", "browse", "logout", "search"]
      regions = ["north", "south", "east", "west"]
    code: |
      global activity_id
      
      activity_id += 1
      
      # Generate user activity with region as initial key
      region = random.choice(regions)
      activity = {
        "activity_id": f"activity_{activity_id:04d}",
        "user_id": random.choice(user_ids),
        "activity_type": random.choice(activity_types),
        "timestamp": int(time.time() * 1000),
        "region": region
      }
      
      # Log the activity generation
      log.info("Generated activity: {} for user {} in region {} - type: {}", 
               activity["activity_id"], activity["user_id"], region, activity["activity_type"])
      
      # Use region as key initially (will be repartitioned by user_id later)
      key = region
      value = activity
    expression: (key, value)
    resultType: (string, json)

producers:
  user_activity_producer:
    generator: generate_user_activity
    interval: 3s
    to:
      topic: user_activities
      keyType: string
      valueType: json